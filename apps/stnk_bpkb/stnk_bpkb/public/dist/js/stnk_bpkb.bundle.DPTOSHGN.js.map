{
  "version": 3,
  "sources": ["../../../../../apps/stnk_bpkb/stnk_bpkb/public/js/sales_common.js"],
  "sourcesContent": ["// Copyright (c) 2024, DAS and Contributors\n// License: GNU General Public License v3. See license.txt\n\nfrappe.provide(\"stnk_bpkb.selling\");\n\nstnk_bpkb.sales_common = {\n    setup_selling_controller: function (extend_class) {\n        // erpnext.sales_common.setup_selling_controller();\n\n        stnk_bpkb.selling.SellingController = class SellingController extends extend_class {\n\n            setup() {            \n                super.setup();\n                // jika field yg digunakan merupakan custom field\n                this.frm._item_table = !in_list([\"FPK\", \"SPK\"], this.frm.doctype) ? \"items\" : null\n                this.frm._custom_field = !in_list([\"FPK\", \"SPK\"], this.frm.doctype) ? \"custom_\" : \"\"\n                this.frm._discount_field = !in_list([\"FPK\", \"SPK\"], this.frm.doctype) ? \"discount_amount\" : \"item_discount_amount\"\n                // var fields = [\"rate\",\"warehouse\",\"amount\"];\n\n                // var grid = cur_frm.get_field(\"items\").grid;\n                // if (grid) grid.set_column_disp(fields, cur_frm.doc.docstatus==0);\n            \n                if(!in_list([\"FPK\", \"SPK\"],this.frm.doctype)){\n                    frappe.ui.form.off(this.frm.doctype + \" Item\", \"rate\")\n                    frappe.ui.form.on(this.frm.doctype + \" Item\", \"rate\", function(frm, cdt, cdn) {\n                        var item = frappe.get_doc(cdt, cdn);\n                        var has_margin_field = frappe.meta.has_field(cdt, 'margin_type');\n            \n                        frappe.model.round_floats_in(item, [\"rate\", \"price_list_rate\"]);\n                        \n                        if(item.price_list_rate && !item.blanket_order_rate) {\n                            var ofr = item.rate - (item[`${frm._custom_field}stnk_rate`] + item[`${frm._custom_field}bpkb_rate`] + item[`${frm._custom_field}bbn_rate`])\n                            if(ofr > item.price_list_rate && has_margin_field) {\n                                // if rate is greater than price_list_rate, set margin\n                                // or set discount\n                                item.discount_percentage = 0;\n                                item.discount_amount = 0;\n\n                                item.margin_type = 'Amount';\n    \n                                // tambahkan nilai otr\n                                item.margin_rate_or_amount = flt(ofr - item.price_list_rate,\n                                    precision(\"margin_rate_or_amount\", item));\n                                item.rate_with_margin = ofr;\n                            } else {\n                                item.discount_percentage = flt((1 - (ofr) / item.price_list_rate) * 100.0,\n                                    precision(\"discount_percentage\", item));\n                                item.discount_amount = flt(item.price_list_rate) - flt(ofr);\n                                item.margin_type = '';\n                                item.margin_rate_or_amount = 0;\n                                item.rate_with_margin = 0;\n                            }\n                        } else {\n                            item.discount_percentage = 0.0;\n                            item.margin_type = '';\n                            item.margin_rate_or_amount = 0;\n                            item.rate_with_margin = 0;\n                        }\n                        item.base_rate_with_margin = item.rate_with_margin * flt(frm.doc.conversion_rate);\n            \n                        cur_frm.cscript.set_gross_profit(item);\n                        cur_frm.cscript.calculate_taxes_and_totals();\n                        cur_frm.cscript.calculate_stock_uom_rate(frm, cdt, cdn);\n                    });\n                }else{\n                    frappe.ui.form.on(this.frm.doctype, \"rate\", function(frm) {\n                        var has_margin_field = frappe.meta.has_field(frm.doc.doctype, 'margin_type');\n            \n                        frappe.model.round_floats_in(frm.doc, [\"rate\", \"price_list_rate\"]);\n            \n                        if(frm.doc.price_list_rate) {\n                            var ofr = frm.doc.rate - (frm.doc[`${frm._custom_field}stnk_rate`] + frm.doc[`${frm._custom_field}bpkb_rate`] + frm.doc[`${frm._custom_field}bbn_rate`])\n                            if(ofr > frm.doc.price_list_rate && has_margin_field) {\n                                // if rate is greater than price_list_rate, set margin\n                                // or set discount\n                                frm.doc.discount_percentage = 0;\n                                frm.doc.item_discount_amount = 0;\n                                frm.doc.margin_type = 'Amount';\n    \n                                // tambahkan nilai otr\n                                frm.doc.margin_rate_or_amount = flt(ofr - frm.doc.price_list_rate,\n                                    precision(\"margin_rate_or_amount\", frm.doc));\n                                frm.doc.rate_with_margin = ofr;\n                            } else {\n                                frm.doc.discount_percentage = flt((1 - (ofr) / frm.doc.price_list_rate) * 100.0,\n                                    precision(\"discount_percentage\", frm.doc));\n                                frm.doc.item_discount_amount = flt(frm.doc.price_list_rate) - flt(ofr);\n                                frm.doc.margin_type = '';\n                                frm.doc.margin_rate_or_amount = 0;\n                                frm.doc.rate_with_margin = 0;\n                            }\n                        } else {\n                            frm.doc.discount_percentage = 0.0;\n                            frm.doc.margin_type = '';\n                            frm.doc.margin_rate_or_amount = 0;\n                            frm.doc.rate_with_margin = 0;\n                        }\n                        frm.doc.base_rate_with_margin = frm.doc.rate_with_margin * flt(frm.doc.conversion_rate);\n                        \n                        cur_frm.cscript.calculate_taxes_and_totals();\n                    });\n            \n                    // frappe.ui.form.on(this.frm.doctype, \"biaya_bpkb\", function(frm, cdt, cdn) {\n                    //     cur_frm.cscript.calculate_taxes_and_totals();\n                    // });\n            \n                    // frappe.ui.form.on(this.frm.doctype, \"biaya_stnk\", function(frm, cdt, cdn) {\n                    //     cur_frm.cscript.calculate_taxes_and_totals();\n                    // });\n                }\n            }\n\n            transaction_date() {                \n                super.transaction_date()\n                this.reaply_pricing_rule()\n            }\n\n            off_the_road_pricing(){\n                this.reaply_pricing_rule()\n            }\n\n            custom_off_the_road_pricing(doc, cdt, cdn){\n                this.item_code(doc, cdt, cdn)\n                this.reaply_pricing_rule()\n            }\n\n            territory(){\n                this.reaply_pricing_rule()\n            }\n\n            custom_territory_pemilik(){\n                this.reaply_pricing_rule()\n            }\n\n            territory_area(){\n                this.reaply_pricing_rule()\n            }\n            \n            custom_territory(doc, cdt, cdn){\n                this.item_code(doc, cdt, cdn)\n                this.reaply_pricing_rule()                \n            }\n\n            custom_territory_area(doc, cdt, cdn){\n                this.item_code(doc, cdt, cdn)\n                this.reaply_pricing_rule()                \n            }\n\n            reaply_pricing_rule() {\n                // console.log('masuk sini');\n                var me = this\n                // CR BARU DISINI, LOOP THIS.FRM.ITEMS JIKA FPK SPK NANTI\n                var items = in_list([\"FPK\", \"SPK\"], this.frm.doctype) ? [this.frm.doc] : this.frm.doc.items;\n                $.each(items || [], function(i, item) {\n                    if(item.item_code || item.product) me.apply_pricing_rule_on_item(item)\n                        me.product(me.frm.doc, me.frm.doc.doctype, me.frm.doc.name)\n                })\n            }\n            \n            // posting_date() {\n            //     super.posting_date()\n            //     var me = this\n            //     $.each(this.frm.doc.items || [], function(i, item) {\n            //         me.apply_pricing_rule_on_item(item)\n            //     })\n            // }\n\n            item_code(doc, cdt, cdn) {\n                var me = this;\n                var item = frappe.get_doc(cdt, cdn);\n                var update_stock = 0, show_batch_dialog = 0;\n        \n                item.weight_per_unit = 0;\n                item.weight_uom = '';\n                item.conversion_factor = 0;\n        \n                if(['Sales Invoice', 'Purchase Invoice'].includes(this.frm.doc.doctype)) {\n                    update_stock = cint(me.frm.doc.update_stock);\n                    show_batch_dialog = update_stock;\n        \n                } else if((this.frm.doc.doctype === 'Purchase Receipt') ||\n                    this.frm.doc.doctype === 'Delivery Note') {\n                    show_batch_dialog = 1;\n                }\n        \n                if (show_batch_dialog && item.use_serial_batch_fields === 1) {\n                    show_batch_dialog = 0;\n                }\n\n                // FLOW UNTUK ARIVAL DOC ITEM\n                var is_ard = false\n                if(this.frm.doc.doctype === \"Arrival Document\"){\n                    is_ard = true\n                }\n        \n                item.barcode = null;\n        \n        \n                if(item.item_code || item.serial_no) {\n                    if(!this.validate_company_and_party()) {\n                        this.frm.fields_dict[\"items\"].grid.grid_rows[item.idx - 1].remove();\n                    } else {\n                        item.pricing_rules = ''\n                        return this.frm.call({\n                            method: \"erpnext.stock.get_item_details.get_item_details\",\n                            child: item,\n                            args: {\n                                doc: me.frm.doc,\n                                args: {\n                                    item_code: item.item_code,\n                                    barcode: item.barcode,\n                                    serial_no: item.serial_no,\n                                    batch_no: item.batch_no,\n                                    set_warehouse: me.frm.doc.set_warehouse,\n                                    warehouse: item.warehouse,\n                                    customer: me.frm.doc.customer || me.frm.doc.party_name,\n                                    quotation_to: me.frm.doc.quotation_to,\n                                    supplier: me.frm.doc.supplier,\n                                    currency: me.frm.doc.currency,\n                                    update_stock: update_stock,\n                                    conversion_rate: me.frm.doc.conversion_rate,\n                                    price_list: me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n                                    price_list_currency: me.frm.doc.price_list_currency,\n                                    plc_conversion_rate: me.frm.doc.plc_conversion_rate,\n                                    company: me.frm.doc.company,\n                                    order_type: me.frm.doc.order_type,\n                                    is_pos: cint(me.frm.doc.is_pos),\n                                    is_return: cint(me.frm.doc.is_return),\n                                    is_subcontracted: me.frm.doc.is_subcontracted,\n                                    ignore_pricing_rule: me.frm.doc.ignore_pricing_rule,\n                                    doctype: me.frm.doc.doctype,\n                                    name: me.frm.doc.name,\n                                    project: item.project || me.frm.doc.project,\n                                    qty: item.qty || 1,\n                                    net_rate: item.rate,\n                                    base_net_rate: item.base_net_rate,\n                                    stock_qty: item.stock_qty,\n                                    conversion_factor: item.conversion_factor,\n                                    weight_per_unit: item.weight_per_unit,\n                                    uom: item.uom,\n                                    weight_uom: item.weight_uom,\n                                    manufacturer: item.manufacturer,\n                                    stock_uom: item.stock_uom,\n                                    pos_profile: cint(me.frm.doc.is_pos) ? me.frm.doc.pos_profile : '',\n                                    cost_center: item.cost_center,\n                                    tax_category: me.frm.doc.tax_category,\n                                    item_tax_template: item.item_tax_template,\n                                    child_doctype: item.doctype,\n                                    child_docname: item.name,\n                                    is_old_subcontracting_flow: me.frm.doc.is_old_subcontracting_flow,\n                                    // teritorry: item.custom_territory\n                                    teritorry: item.custom_territory\n                                }\n                            },\n        \n                            callback: function(r) {\n                                if(!r.exc) {\n                                    frappe.run_serially([\n                                        // FLOW UNTUK ARIVAL DOC ITEM\n                                        () =>{\n                                            if(is_ard){\n                                                var d = locals[cdt][cdn];\n\n                                                if(d.type_upselling === \"Item Fix\"){\n                                                    d.used_quantity = d.qty                                                    \n                                                }else{\n                                                    d.used_quantity = 0\n                                                }                                                \n                                            }\n                                        },\n                                        () => {\n                                            var d = locals[cdt][cdn];\n                                            me.add_taxes_from_item_tax_template(d.item_tax_rate);\n                                            if (d.free_item_data && d.free_item_data.length > 0) {\n                                                me.apply_product_discount(d);\n                                            }\n                                        },\n                                        () => {\n                                            // for internal customer instead of pricing rule directly apply valuation rate on item\n                                            if ((me.frm.doc.is_internal_customer || me.frm.doc.is_internal_supplier) && me.frm.doc.represents_company === me.frm.doc.company) {\n                                                me.get_incoming_rate(item, me.frm.posting_date, me.frm.posting_time,\n                                                    me.frm.doc.doctype, me.frm.doc.company);\n                                            } else {\n                                                me.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn);\n                                            }\n                                        },\n                                        () => {\n                                            if (me.frm.doc.is_internal_customer || me.frm.doc.is_internal_supplier) {\n                                                me.calculate_taxes_and_totals();\n                                            }\n                                        },\n                                        () => me.toggle_conversion_factor(item),\n                                        () => {\n                                            if (show_batch_dialog && !frappe.flags.trigger_from_barcode_scanner)\n                                                return frappe.db.get_value(\"Item\", item.item_code, [\"has_batch_no\", \"has_serial_no\"])\n                                                    .then((r) => {\n                                                        if (r.message &&\n                                                        (r.message.has_batch_no || r.message.has_serial_no)) {\n                                                            frappe.flags.hide_serial_batch_dialog = false;\n                                                        } else {\n                                                            show_batch_dialog = false;\n                                                        }\n                                                    });\n                                        },\n                                        () => {\n                                            // check if batch serial selector is disabled or not\n                                            if (show_batch_dialog && !frappe.flags.hide_serial_batch_dialog)\n                                                return frappe.db.get_single_value('Stock Settings', 'disable_serial_no_and_batch_selector')\n                                                    .then((value) => {\n                                                        if (value) {\n                                                            frappe.flags.hide_serial_batch_dialog = true;\n                                                        }\n                                                    });\n                                        },\n                                        () => {\n                                            if(show_batch_dialog && !frappe.flags.hide_serial_batch_dialog && !frappe.flags.dialog_set) {\n                                                var d = locals[cdt][cdn];\n                                                $.each(r.message, function(k, v) {\n                                                    if(!d[k]) d[k] = v;\n                                                });\n        \n                                                if (d.has_batch_no && d.has_serial_no) {\n                                                    d.batch_no = undefined;\n                                                }\n        \n                                                frappe.flags.dialog_set = true;\n                                                erpnext.show_serial_batch_selector(me.frm, d, (item) => {\n                                                    me.frm.script_manager.trigger('qty', item.doctype, item.name);\n                                                    if (!me.frm.doc.set_warehouse)\n                                                        me.frm.script_manager.trigger('warehouse', item.doctype, item.name);\n                                                    me.apply_price_list(item, true);\n                                                }, undefined, !frappe.flags.hide_serial_batch_dialog);\n                                            } else {\n                                                frappe.flags.dialog_set = false;\n                                            }\n                                        },\n                                        () => me.conversion_factor(doc, cdt, cdn, true),\n                                        () => me.remove_pricing_rule(item),\n                                        () => {\n                                            if (item.apply_rule_on_other_items) {\n                                                let key = item.name;\n                                                me.apply_rule_on_other_items({key: item});\n                                            }\n                                        },\n                                        () => {\n                                            var company_currency = me.get_company_currency();\n                                            me.update_item_grid_labels(company_currency);\n                                        }\n                                    ]);\n                                }\n                            }\n                        });\n                    }\n                }\n            }\n\n            qty(doc, cdt, cdn) {\n                if (!this.frm.doc.__onload?.load_after_mapping) {\n                    let item = frappe.get_doc(cdt, cdn);\n                    // item.pricing_rules = ''\n                    frappe.run_serially([\n                        () => this.remove_pricing_rule_for_item(item),\n                        () => this.conversion_factor(doc, cdt, cdn, true),\n                        // () => this.apply_price_list(item, true), //reapply price list before applying pricing rule                                                \n                        () => this.calculate_stock_uom_rate(doc, cdt, cdn),\n                        () => this.apply_pricing_rule(item, true),                        \n                    ]);\n                    // this.item_code(doc, cdt, cdn)\n                    this.reaply_pricing_rule();                    \n                }                \n            }\n\n            product(doc, cdt, cdn) {\n                var me = this;\n                var update_stock = 0, show_batch_dialog = 0;\n                \n                if(doc.product) {\n                    return frappe.call({\n                        method: \"erpnext.stock.get_item_details.get_item_details\",\n                        args: {\n                            doc: me.frm.doc,\n                            args: {\n                                item_code: doc.product,\n                                warehouse: me.frm.doc.set_warehouse,\n                                customer: me.frm.doc.customer || me.frm.doc.party_name,\n                                quotation_to: me.frm.doc.quotation_to,\n                                supplier: me.frm.doc.supplier,\n                                currency: me.frm.doc.currency,\n                                update_stock: update_stock,\n                                conversion_rate: me.frm.doc.conversion_rate,\n                                price_list: me.frm.doc.selling_price_list || me.frm.doc.buying_price_list,\n                                price_list_currency: me.frm.doc.price_list_currency,\n                                plc_conversion_rate: me.frm.doc.plc_conversion_rate,\n                                company: me.frm.doc.company,\n                                order_type: me.frm.doc.order_type,\n                                is_pos: cint(me.frm.doc.is_pos),\n                                is_return: cint(me.frm.doc.is_return),\n                                is_subcontracted: me.frm.doc.is_subcontracted,\n                                ignore_pricing_rule: me.frm.doc.ignore_pricing_rule,\n                                doctype: me.frm.doc.doctype,\n                                name: me.frm.doc.name,\n                                project: me.frm.doc.project,\n                                qty: 1,\n                                net_rate: me.frm.doc.rate,\n                                base_net_rate: me.frm.doc.base_net_rate,\n                                stock_qty: me.frm.doc.stock_qty,\n                                conversion_factor: doc.conversion_factor,\n                                weight_per_unit: doc.weight_per_unit,\n                                uom: me.frm.doc.uom,\n                                weight_uom: me.frm.doc.weight_uom,\n                                manufacturer: me.frm.doc.manufacturer,\n                                stock_uom: me.frm.doc.stock_uom,\n                                pos_profile: cint(me.frm.doc.is_pos) ? me.frm.doc.pos_profile : '',\n                                cost_center: me.frm.doc.cost_center,\n                                tax_category: me.frm.doc.tax_category,\n                                item_tax_template: me.frm.doc.item_tax_template,\n                                is_old_subcontracting_flow: me.frm.doc.is_old_subcontracting_flow,\n                                // teritorry: me.frm.doc.custom_territory_pemilik || me.frm.doc.territory,\n                                teritorry: me.frm.doc.territory_area,\n                            }\n                        },\n        \n                        callback: function(r) {\n                            if(!r.exc) {\n                                for (var key in r.message) {\n                                    me.frm.doc[key] = r.message[key];\n                                }\n                                \n                                frappe.run_serially([\n                                    () => {\n                                        me.frm.script_manager.trigger(\"price_list_rate\", cdt, cdn);\n                                    },\n                                ]);\n                            }\n                        }\n                    });\n                }\n            }\n\n            update_item_grid_labels(company_currency) {\n                this.frm.set_currency_labels([\n                    \"base_rate\", \"base_net_rate\", \"base_price_list_rate\",\n                    \"base_amount\", \"base_net_amount\", \"base_rate_with_margin\"\n                ], company_currency, this.frm._item_table);\n\n                this.frm.set_currency_labels([\n                    \"rate\", \"net_rate\", \"price_list_rate\", \"amount\", `${this.frm._custom_field}otr_amount`,\n                    \"net_amount\", \"stock_uom_rate\", \"rate_with_margin\"\n                ], this.frm.doc.currency, this.frm._item_table);\n            }\n\n            toggle_item_grid_columns(company_currency) {\n                const me = this;\n                // toggle columns\n                this.frm.toggle_display(\"base_net_total\", (show && (me.frm.doc.currency != company_currency)));\n                var item_grid = this.frm.fields_dict[\"items\"].grid;\n                $.each([\"base_rate\", \"base_price_list_rate\", \"base_amount\", \"base_rate_with_margin\"], function(i, fname) {\n                    if(frappe.meta.get_docfield(item_grid.doctype, fname))\n                        item_grid.set_column_disp(fname, me.frm.doc.currency != company_currency);\n                        me.frm.toggle_display(fname, me.frm.doc.currency != company_currency);\n                });\n        \n                var show = (cint(cur_frm.doc.discount_amount)) ||\n                    ((cur_frm.doc.taxes || []).filter(function(d) {return d.included_in_print_rate===1}).length);\n        \n                $.each([\"net_rate\", \"net_amount\"], function(i, fname) {\n                    if(frappe.meta.get_docfield(item_grid.doctype, fname))\n                        item_grid.set_column_disp(fname, show);\n                        me.frm.toggle_display(fname, me.frm.doc.currency != company_currency);\n\n                });\n        \n                $.each([\"base_net_rate\", \"base_net_amount\"], function(i, fname) {\n                    if(frappe.meta.get_docfield(item_grid.doctype, fname))\n                        item_grid.set_column_disp(fname, (show && (me.frm.doc.currency != company_currency)));\n                        me.frm.toggle_display(fname, me.frm.doc.currency != company_currency);\n\n                });\n            }\n            \n            _set_values_for_item_list(children) {\n                const items_rule_dict = {};\n        \n                for (const child of children) {\n                    const existing_pricing_rule = frappe.model.get_value(child.doctype, child.name, \"pricing_rules\");\n        \n                    for (const [key, value] of Object.entries(child)) {\n                        if (![\"doctype\", \"name\"].includes(key)) {\n                            // if (key === \"price_list_rate\") {\n                            //     frappe.model.set_value(child.doctype, child.name, \"rate\", value);\n                            // }\n        \n                            if (key === \"pricing_rules\") {\n                                frappe.model.set_value(child.doctype, child.name, key, value);\n                            }\n        \n                            if (key !== \"free_item_data\") {\n                                if (child.apply_rule_on_other_items && JSON.parse(child.apply_rule_on_other_items).length) {\n                                    if (!in_list(JSON.parse(child.apply_rule_on_other_items), child.item_code)) {\n                                        continue;\n                                    }\n                                }\n        \n                                frappe.model.set_value(child.doctype, child.name, key, value);\n                            }\n                        }\n                    }\n        \n                    frappe.model.round_floats_in(\n                        frappe.get_doc(child.doctype, child.name),\n                        [\"price_list_rate\", \"discount_percentage\"],\n                    );\n        \n                    // if pricing rule set as blank from an existing value, apply price_list\n                    if (!this.frm.doc.ignore_pricing_rule && existing_pricing_rule && !child.pricing_rules) {\n                        this.apply_price_list(frappe.get_doc(child.doctype, child.name));\n                    } else if (!child.pricing_rules) {\n                        this.remove_pricing_rule(frappe.get_doc(child.doctype, child.name));\n                    }\n        \n                    if (child.free_item_data && child.free_item_data.length > 0) {\n                        this.apply_product_discount(child);\n                    }\n        \n                    if (child.apply_rule_on_other_items && JSON.parse(child.apply_rule_on_other_items).length) {\n                        items_rule_dict[child.name] = child;\n                    }\n                }\n        \n                this.apply_rule_on_other_items(items_rule_dict);\n                this.calculate_taxes_and_totals();\n            }\n            \n            price_list_rate(doc, cdt, cdn) {\n                var item = frappe.get_doc(cdt, cdn);\n                frappe.model.round_floats_in(item, [\"price_list_rate\", \"discount_percentage\"]);\n        \n                // check if child doctype is Sales Order Item/Quotation Item and calculate the rate\n                if (in_list([\"Quotation Item\", \"Sales Order Item\", \n                    \"Delivery Note Item\", \"Sales Invoice Item\", \"POS Invoice Item\", \"Purchase Invoice Item\", \"Purchase Order Item\", \"Purchase Receipt Item\", \n                    \"FPK\", \"SPK\", \"Arrival Document Item\", \"Billing Document Item\"\n                ]), cdt)\n                    this.apply_pricing_rule_on_item(item);\n                else\n                    item.rate = flt(item.price_list_rate * (1 - item.discount_percentage / 100.0),\n                        precision(\"rate\", item));\n        \n                this.calculate_taxes_and_totals();\n            }\n            \n            async apply_pricing_rule_on_item(item) {\n                var me = this\n                \n                let effective_item_rate = item.price_list_rate;\n                let item_rate = item.rate;\n\n                if ([\"Sales Order\", \"Quotation\"].includes(item.parenttype) && item.blanket_order_rate) {\n                    effective_item_rate = item.blanket_order_rate;\n                }\n                \n                var territory_field = \"\"\n                var is_ignore_rule_bbn = \"\"\n                var custom_term_portion = 100\n                if([\"Sales Order\", \"Quotation\", \"Delivery Note\", \"Sales Invoice\", \"Arrival Document\", \"Billing Document\"].includes(item.parenttype)){\n                    territory_field = item.custom_territory_area\n                    is_ignore_rule_bbn = item.custom_off_the_road_pricing\n                    if([\"Sales Invoice\"].includes(item.parenttype)){\n                        custom_term_portion = item.custom_term_portion || 100\n                    }\n                    else{\n                        custom_term_portion = 100\n                    }\n                }else{\n                    territory_field = this.frm.doc.custom_territory_pemilik || this.frm.doc.territory\n                    is_ignore_rule_bbn = this.frm.doc.off_the_road_pricing\n                    custom_term_portion = 100\n                }\n\n                await frappe.call({\n                    method: \"stnk_bpkb.controllers.get_items_detail.get_rule_stnk_bpkb\",\n                    args: {\n                        item_code: item.item_code || item.product,\n                        teritory: territory_field,\n                        date: this.frm.doc.transaction_date || this.frm.doc.posting_date,\n                        is_ignore_rule_bbn: is_ignore_rule_bbn,\n                    },\n                    callback: (r) => {\n                        if(!r.exc) {    \n                            console.log('hare');\n                            if(window.location.hostname == \"gtm.digitalasiasolusindo.com\"){                                                                              \n                                console.log('GTM ONLY');\n                            }\n                            item[`${me.frm._custom_field}stnk_rate`] = item[`${me.frm._custom_field}bpkb_rate`] = item[`${me.frm._custom_field}bbn_rate`] = 0.0\n                            item[`${me.frm._custom_field}stnk_account`] = item[`${me.frm._custom_field}bpkb_account`] = item[`${me.frm._custom_field}bbn_account`] = \"\"\n                            item[`${me.frm._custom_field}vendor`] = item[`${me.frm._custom_field}vendor`] = item[`${me.frm._custom_field}vendor`] = \"\"\n                            $.each(r.message || [], function(i, rule) {\n                                if(!rule.amount) return                                 \n                                item[`${me.frm._custom_field + rule.type.toLowerCase()}_rate`] = rule.amount * (custom_term_portion/100)\n                                item[`${me.frm._custom_field + rule.type.toLowerCase()}_account`] = rule.coa\n                                item[`${me.frm._custom_field}vendor`] = rule.vendor\n                                effective_item_rate += flt(rule.amount * (custom_term_portion/100))\n                            })\n                        }\n                    }\n                })\n\n                if (item.margin_type == \"Percentage\") {\n                    item.rate_with_margin = flt(effective_item_rate)\n                        + flt(effective_item_rate) * ( flt(item.margin_rate_or_amount) / 100);\n                } else {\n                    item.rate_with_margin = flt(effective_item_rate) + flt(item.margin_rate_or_amount);\n                }\n                item.base_rate_with_margin = flt(item.rate_with_margin) * flt(this.frm.doc.conversion_rate);\n                \n                \n                item_rate = flt(item.rate_with_margin , precision(\"rate\", item));\n                if (item.discount_percentage && !item[this.frm._discount_field]) {\n                    item[this.frm._discount_field] = flt(item.rate_with_margin) * flt(item.discount_percentage) / 100;\n                }\n        \n                if (item[this.frm._discount_field] > 0) {\n                    item_rate = flt((item.rate_with_margin) - (item[this.frm._discount_field]), precision('rate', item));\n                    item.discount_percentage = 100 * flt(item[this.frm._discount_field]) / flt(item.rate_with_margin);\n                }\n                \n                if([\"Sales Order\", \"Quotation\", \"Delivery Note\", \"Sales Invoice\", \"Arrival Document\", \"Billing Document\"].includes(item.parenttype)){\n                    frappe.model.set_value(item.doctype, item.name, \"rate\", item_rate);\n                }else{\n                    frappe.model.set_value(item.doctype, item.name, \"rate\", effective_item_rate);\n                }                \n            }\n\n            _calculate_taxes_and_totals() {\n                const is_quotation = this.frm.doc.doctype == \"Quotation\";\n                // CR BARU DISINI, LOOP THIS.FRM.ITEMS JIKA FPK SPK NANTI\n                this.frm._items = in_list([\"FPK\", \"SPK\"] ,this.frm.doctype) ? [this.frm.doc] : is_quotation ? this.filtered_items() : this.frm.doc.items;\n                \n                this.validate_conversion_rate();\n                this.calculate_item_values();\n                this.initialize_taxes();\n                this.determine_exclusive_rate();\n                this.calculate_net_total();\n                this.calculate_taxes();\n                this.manipulate_grand_total_for_inclusive_tax();\n                this.calculate_totals();\n                this._cleanup();\n            }\n            \n            calculate_item_values() {\n                var me = this;\n                if (!this.discount_amount_applied) {\n                    // if(this.frm._single_item) return this.single_item_value()\n                    for (const item of this.frm._items || []) {\n                        frappe.model.round_floats_in(item);\n                        // CR BARU\n                        if(window.location.hostname == \"gtm.digitalasiasolusindo.com\"){\n                            var total_additional_items_fpk_spk = 0\n                            if([\"FPK\", \"SPK\"].includes(me.frm.doc.doctype)){\n                                total_additional_items_fpk_spk = item.total_additional_items\n                            }\n                            item.net_rate = item.rate - item[`${this.frm._custom_field}stnk_rate`] - item[`${this.frm._custom_field}bpkb_rate`] - item[`${this.frm._custom_field}bbn_rate`] + total_additional_items_fpk_spk;                            \n                            console.log(total_additional_items_fpk_spk, item.net_rate);\n                        }else{\n                            item.net_rate = item.rate - item[`${this.frm._custom_field}stnk_rate`] - item[`${this.frm._custom_field}bpkb_rate`] - item[`${this.frm._custom_field}bbn_rate`];\n                        }\n                        item.qty = item.qty === undefined ? (me.frm.doc.is_return ? -1 : 1) : item.qty;\n        \n                        if (!(me.frm.doc.is_return || me.frm.doc.is_debit_note)) {\n                            item[`${this.frm._custom_field}otr_amount`] = flt(item.rate * item.qty, precision(`${this.frm._custom_field}otr_amount`, item));                            \n                            item.net_amount = item.amount = flt(item.net_rate * item.qty, precision(\"amount\", item));\n                        }\n                        else {\n                            // allow for '0' qty on Credit/Debit notes\n                            let qty = flt(item.qty);\n                            if (!qty) {\n                                qty = (me.frm.doc.is_debit_note ? 1 : -1);\n                                if (me.frm.doc.doctype !== \"Purchase Receipt\" && me.frm.doc.is_return === 1) {\n                                    // In case of Purchase Receipt, qty can be 0 if all items are rejected\n                                    qty = flt(item.qty);\n                                }\n                            }\n        \n                            item[`${this.frm._custom_field}otr_amount`] = flt(item.rate * qty, precision(`${this.frm._custom_field}otr_amount`, item));\n                            item.net_amount = item.amount = flt(item.net_rate * qty, precision(\"net_amount\", item));\n                        }\n                        \n                        item[`${this.frm._custom_field}stnk_amount`] = flt(item[`${this.frm._custom_field}stnk_rate`] * item.qty, precision(`${this.frm._custom_field}stnk_amount`, item));\n                        item[`${this.frm._custom_field}bpkb_amount`] = flt(item[`${this.frm._custom_field}bpkb_rate`] * item.qty, precision(`${this.frm._custom_field}bpkb_amount`, item));\n                        item[`${this.frm._custom_field}bbn_amount`] = flt(item[`${this.frm._custom_field}bbn_rate`] * item.qty, precision(`${this.frm._custom_field}bbn_amount`, item));\n        \n                        item.item_tax_amount = 0.0;\n                        item.total_weight = flt(item.weight_per_unit * item.stock_qty);\n        \n                        me.set_in_company_currency(item, [\"price_list_rate\", \"rate\", \"amount\", \"net_rate\", \"net_amount\"]);\n                    }\n                }\n            }\n            \n            initialize_taxes() {\n                var me = this;\n        \n                $.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n                    if (!tax.dont_recompute_tax) {\n                        tax.item_wise_tax_detail = {};\n                    }\n                    var tax_fields = [\"total\", \"tax_amount_after_discount_amount\",\n                        \"tax_amount_for_current_item\", \"grand_total_for_current_item\",\n                        \"tax_fraction_for_current_item\", \"grand_total_fraction_for_current_item\"];\n        \n                    if (cstr(tax.charge_type) != \"Actual\" &&\n                        !(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n                        tax_fields.push(\"tax_amount\");\n                    }\n        \n                    $.each(tax_fields, function(i, fieldname) { tax[fieldname] = 0.0; });\n        \n                    if (!this.discount_amount_applied) {\n                        erpnext.accounts.taxes.validate_taxes_and_charges(tax.doctype, tax.name);\n                        erpnext.accounts.taxes.validate_inclusive_tax(tax);\n                    }\n                    frappe.model.round_floats_in(tax);\n                });\n            }\n        \n            calculate_taxes() {\n                var me = this;\n                this.frm.doc.rounding_adjustment = 0;\n                var actual_tax_dict = {};\t\t\n        \n                // maintain actual tax rate based on idx\n                $.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n                    if (tax.charge_type == \"Actual\") {\n                        actual_tax_dict[tax.idx] = flt(tax.tax_amount, precision(\"tax_amount\", tax));\n                    }\n                });\n                \n                // if(this.frm._single_item){\n                //     var item_tax_map = me._load_item_tax_rate(me.frm.doc.item_tax_rate);\n                //     $.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n                //         // tax_amount represents the amount of tax for the current step\n                //         var current_tax_amount = me.get_current_tax_amount(me.frm.doc, tax, item_tax_map);\n            \n                //         // Adjust divisional loss to the last item\n                //         if (tax.charge_type == \"Actual\") {\n                //             actual_tax_dict[tax.idx] -= current_tax_amount;\n                //             current_tax_amount += actual_tax_dict[tax.idx];\n                //         }\n            \n                //         // accumulate tax amount into tax.tax_amount\n                //         if (tax.charge_type != \"Actual\" &&\n                //             !(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n                //             tax.tax_amount += current_tax_amount;\n                //         }\n            \n                //         // store tax_amount for current item as it will be used for\n                //         // charge type = 'On Previous Row Amount'\n                //         tax.tax_amount_for_current_item = current_tax_amount;\n            \n                //         // tax amount after discount amount\n                //         tax.tax_amount_after_discount_amount += current_tax_amount;\n            \n                //         // for buying\n                //         if(tax.category) {\n                //             // if just for valuation, do not add the tax amount in total\n                //             // hence, setting it as 0 for further steps\n                //             current_tax_amount = (tax.category == \"Valuation\") ? 0.0 : current_tax_amount;\n            \n                //             current_tax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n                //         }\n            \n                //         // note: grand_total_for_current_item contains the contribution of\n                //         // item's amount, previously applied tax and the current tax on that item\n                //         if(i==0) {\n                //             tax.grand_total_for_current_item = flt(me.frm.doc.net_amount + current_tax_amount);\n                //         } else {\n                //             tax.grand_total_for_current_item =\n                //                 flt(me.frm.doc[\"taxes\"][i-1].grand_total_for_current_item + current_tax_amount);\n                //         }\n            \n                //         // set precision in the last item iteration\t\t\n                //         me.round_off_totals(tax);\n                //         me.set_in_company_currency(tax,\n                //             [\"tax_amount\", \"tax_amount_after_discount_amount\"]);\n            \n                //         me.round_off_base_values(tax);\n            \n                //         // in tax.total, accumulate grand total for each item\n                //         me.set_cumulative_total(i, tax);\n            \n                //         me.set_in_company_currency(tax, [\"total\"]);\n            \n                //         // adjust Discount Amount loss in last tax iteration\n                //         if ((i == me.frm.doc[\"taxes\"].length - 1) && me.discount_amount_applied\n                //             && me.frm.doc.apply_discount_on == \"Grand Total\" && me.frm.doc.discount_amount) {\n                            \n                //             var added_charge = flt(me.frm.doc[`${this.frm._custom_field}total_stnk`]) + flt(me.frm.doc[`${this.frm._custom_field}total_bpkb`])\n                //             me.frm.doc.rounding_adjustment = flt(me.frm.doc.grand_total - added_charge -\n                //                 flt(me.frm.doc.discount_amount) - tax.total, precision(\"rounding_adjustment\"));\n                //         }\n                        \n                //     });\n                // }else{\n                $.each(this.frm._items || [], function(n, item) {\n                    var item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n                    $.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n                        // tax_amount represents the amount of tax for the current step\n                        var current_tax_amount = me.get_current_tax_amount(item, tax, item_tax_map);\n                        if (frappe.flags.round_row_wise_tax) {\n                            current_tax_amount = flt(current_tax_amount, precision(\"tax_amount\", tax));\n                        }\n        \n                        // Adjust divisional loss to the last item\n                        if (tax.charge_type == \"Actual\") {\n                            actual_tax_dict[tax.idx] -= current_tax_amount;\n                            if (n == me.frm._items.length - 1) {\n                                current_tax_amount += actual_tax_dict[tax.idx];\n                            }\n                        }\n        \n                        // accumulate tax amount into tax.tax_amount\n                        if (tax.charge_type != \"Actual\" &&\n                            !(me.discount_amount_applied && me.frm.doc.apply_discount_on==\"Grand Total\")) {\n                            tax.tax_amount += current_tax_amount;\n                        }\n        \n                        // store tax_amount for current item as it will be used for\n                        // charge type = 'On Previous Row Amount'\n                        tax.tax_amount_for_current_item = current_tax_amount;\n        \n                        // tax amount after discount amount\n                        tax.tax_amount_after_discount_amount += current_tax_amount;\n        \n                        // for buying\n                        if(tax.category) {\n                            // if just for valuation, do not add the tax amount in total\n                            // hence, setting it as 0 for further steps\n                            current_tax_amount = (tax.category == \"Valuation\") ? 0.0 : current_tax_amount;\n        \n                            current_tax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n                        }\n        \n                        // note: grand_total_for_current_item contains the contribution of\n                        // item's amount, previously applied tax and the current tax on that item\n                        if(i==0) {\n                            tax.grand_total_for_current_item = flt(item.net_amount + current_tax_amount);\n                        } else {\n                            tax.grand_total_for_current_item =\n                                flt(me.frm.doc[\"taxes\"][i-1].grand_total_for_current_item + current_tax_amount);\n                        }\n        \n                        // set precision in the last item iteration\n                        if (n == me.frm._items.length - 1) {\n                            me.round_off_totals(tax);\n                            me.set_in_company_currency(tax,\n                                [\"tax_amount\", \"tax_amount_after_discount_amount\"]);\n        \n                            me.round_off_base_values(tax);\n        \n                            // in tax.total, accumulate grand total for each item\n                            me.set_cumulative_total(i, tax);\n        \n                            me.set_in_company_currency(tax, [\"total\"]);\n        \n                            // adjust Discount Amount loss in last tax iteration\n                            if ((i == me.frm.doc[\"taxes\"].length - 1) && me.discount_amount_applied\n                                && me.frm.doc.apply_discount_on == \"Grand Total\" && me.frm.doc.discount_amount) {\n\n                                var added_charge = flt(me.frm.doc[`${me.frm._custom_field}total_stnk`]) + flt(me.frm.doc[`${me.frm._custom_field}total_bpkb`]) + flt(me.frm.doc[`${me.frm._custom_field}total_bbn`]) \n                                me.frm.doc.rounding_adjustment = flt(me.frm.doc.grand_total - added_charge -\n                                    flt(me.frm.doc.discount_amount) - tax.total, precision(\"rounding_adjustment\"));\n                                    \n                                console.log(\n                                `${me.frm.doc.grand_total} - ${added_charge} - ${flt(me.frm.doc.discount_amount)} - ${tax.total}`\n                                );\n                                // console.log(precision(\"rounding_adjustment\"));\n                            }\n                        }\n                    });\n                });\n                // }\n            }\n        \n            determine_exclusive_rate() {\n                var me = this;\n        \n                var has_inclusive_tax = false;\n                $.each(me.frm.doc[\"taxes\"] || [], function(i, row) {\n                    if(cint(row.included_in_print_rate)) has_inclusive_tax = true;\n                });\n                if(has_inclusive_tax==false) return;\n                \n                $.each(me.frm._items || [], function(n, item) {\n                    var item_tax_map = me._load_item_tax_rate(item.item_tax_rate);\n                    var cumulated_tax_fraction = 0.0;\n                    var total_inclusive_tax_amount_per_qty = 0;\n                    $.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n                        var current_tax_fraction = me.get_current_tax_fraction(tax, item_tax_map);\n                        tax.tax_fraction_for_current_item = current_tax_fraction[0];\n                        var inclusive_tax_amount_per_qty = current_tax_fraction[1];\n        \n                        if(i==0) {\n                            tax.grand_total_fraction_for_current_item = 1 + tax.tax_fraction_for_current_item;\n                        } else {\n                            tax.grand_total_fraction_for_current_item =\n                                me.frm.doc[\"taxes\"][i-1].grand_total_fraction_for_current_item +\n                                tax.tax_fraction_for_current_item;\n                        }\n        \n                        cumulated_tax_fraction += tax.tax_fraction_for_current_item;\n                        total_inclusive_tax_amount_per_qty += inclusive_tax_amount_per_qty * flt(item.qty);\n                    });\n        \n                    if(!me.discount_amount_applied && item.qty && (total_inclusive_tax_amount_per_qty || cumulated_tax_fraction)) {\n                        var amount = flt(item.amount) - total_inclusive_tax_amount_per_qty;\n                        item.net_amount = flt(amount / (1 + cumulated_tax_fraction));\n                        item.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n        \n                        me.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n                    }\n                });\n\n                // var item_tax_map = me._load_item_tax_rate(me.frm.doc.item_tax_rate);\n                // var cumulated_tax_fraction = 0.0;\n                // var total_inclusive_tax_amount_per_qty = 0;\n                // $.each(me.frm.doc[\"taxes\"] || [], function(i, tax) {\n                //     var current_tax_fraction = me.get_current_tax_fraction(tax, item_tax_map);\n                //     tax.tax_fraction_for_current_item = current_tax_fraction[0];\n                //     var inclusive_tax_amount_per_qty = current_tax_fraction[1];\n        \n                //     if(i==0) {\n                //         tax.grand_total_fraction_for_current_item = 1 + tax.tax_fraction_for_current_item;\n                //     } else {\n                //         tax.grand_total_fraction_for_current_item =\n                //             me.frm.doc[\"taxes\"][i-1].grand_total_fraction_for_current_item +\n                //             tax.tax_fraction_for_current_item;\n                //     }\n        \n                //     cumulated_tax_fraction += tax.tax_fraction_for_current_item;\n                //     total_inclusive_tax_amount_per_qty += inclusive_tax_amount_per_qty * flt(me.frm.doc.qty);\n                // });\n        \n                // if(!me.discount_amount_applied && me.frm.doc.qty && (total_inclusive_tax_amount_per_qty || cumulated_tax_fraction)) {\n                //     var amount = flt(me.frm.doc.amount) - total_inclusive_tax_amount_per_qty;\n                //     me.frm.doc.net_amount = flt(amount / (1 + cumulated_tax_fraction));\n                //     me.frm.doc.net_rate = me.frm.doc.qty ? flt(me.frm.doc.net_amount / me.frm.doc.qty, precision(\"net_rate\", me.frm.doc)) : 0;\n        \n                //     me.set_in_company_currency(me.frm.doc, [\"net_rate\", \"net_amount\"]);\n                // }\n            }\n        \n            apply_discount_amount() {\n                var me = this;\n                var distributed_amount = 0.0;\n                this.frm.doc.base_discount_amount = 0.0;\n        \n                if (this.frm.doc.discount_amount) {\n                    if(!this.frm.doc.apply_discount_on)\n                        frappe.throw(__(\"Please select Apply Discount On\"));\n        \n                    this.frm.doc.base_discount_amount = flt(this.frm.doc.discount_amount * this.frm.doc.conversion_rate,\n                        precision(\"base_discount_amount\"));\n        \n                    if (this.frm.doc.apply_discount_on == \"Grand Total\" && this.frm.doc.is_cash_or_non_trade_discount) {\n                        return;\n                    }\n        \n                    var total_for_discount_amount = this.get_total_for_discount_amount();\n                    var net_total = 0;\n                    // calculate item amount after Discount Amount\n                    if (total_for_discount_amount) {\n                        $.each(this.frm._items || [], function(i, item) {\n                            distributed_amount = flt(me.frm.doc.discount_amount) * item.net_amount / total_for_discount_amount;\n                            item.net_amount = flt(item.net_amount - distributed_amount,\n                                precision(\"base_amount\", item));\n                            net_total += item.net_amount;\n        \n                            // discount amount rounding loss adjustment if no taxes\n                            if ((!(me.frm.doc.taxes || []).length || total_for_discount_amount==me.frm.doc.net_total || (me.frm.doc.apply_discount_on == \"Net Total\"))\n                                    && i == (me.frm._items || []).length - 1) {\n                                var discount_amount_loss = flt(me.frm.doc.net_total - net_total\n                                    - me.frm.doc.discount_amount, precision(\"net_total\"));\n                                item.net_amount = flt(item.net_amount + discount_amount_loss,\n                                    precision(\"net_amount\", item));\n                            }\n                            item.net_rate = item.qty ? flt(item.net_amount / item.qty, precision(\"net_rate\", item)) : 0;\n                            me.set_in_company_currency(item, [\"net_rate\", \"net_amount\"]);\n                        });\n\n                        // distributed_amount = flt(me.frm.doc.discount_amount) * me.frm.doc.net_amount / total_for_discount_amount;\n                        // me.frm.doc.net_amount = flt(me.frm.doc.net_amount - distributed_amount,\n                        //     precision(\"base_amount\", me.frm.doc));\n                        // net_total += me.frm.doc.net_amount;\n                        // // discount amount rounding loss adjustment if no taxes\n                        // if ((!(me.frm.doc.taxes || []).length || total_for_discount_amount==me.frm.doc.net_total || (me.frm.doc.apply_discount_on == \"Net Total\"))) {\n                        //     var discount_amount_loss = flt(me.frm.doc.net_total - net_total\n                        //         - me.frm.doc.discount_amount, precision(\"net_total\"));\n                        //     me.frm.doc.net_amount = flt(me.frm.doc.net_amount + discount_amount_loss,\n                        //         precision(\"net_amount\", me.frm.doc));\n                        // }\n        \n                        // me.frm.doc.net_rate = me.frm.doc.qty ? flt(me.frm.doc.net_amount / me.frm.doc.qty, precision(\"net_rate\", me.frm.doc)) : 0;\n                        //     me.set_in_company_currency(me.frm.doc, [\"net_rate\", \"net_amount\"]);\n        \n                        this.discount_amount_applied = true;\n                        this._calculate_taxes_and_totals();\n                    }\n                }\n            }\n        \n            get_total_for_discount_amount() {\n                if(this.frm.doc.apply_discount_on == \"Net Total\") {\n                    return this.frm.doc.net_total;\n                } else {\n                    var total_actual_tax = 0.0;\n                    var actual_taxes_dict = {};\n        \n                    $.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n                        if ([\"Actual\", \"On Item Quantity\"].includes(tax.charge_type)) {\n                            var tax_amount = (tax.category == \"Valuation\") ? 0.0 : tax.tax_amount;\n                            tax_amount *= (tax.add_deduct_tax == \"Deduct\") ? -1.0 : 1.0;\n                            actual_taxes_dict[tax.idx] = tax_amount;\n                        } else if (actual_taxes_dict[tax.row_id] !== null) {\n                            var actual_tax_amount = flt(actual_taxes_dict[tax.row_id]) * flt(tax.rate) / 100;\n                            actual_taxes_dict[tax.idx] = actual_tax_amount;\n                        }\n                    });\n        \n                    $.each(actual_taxes_dict, function(key, value) {\n                        if (value) total_actual_tax += value;\n                    });\n                    \n                    total_actual_tax += flt(this.frm.doc[`${this.frm._custom_field}total_stnk`]) + flt(this.frm.doc[`${this.frm._custom_field}total_bpkb`]) + flt(this.frm.doc[`${this.frm._custom_field}total_bbn`])\n                    return flt(this.frm.doc.grand_total - total_actual_tax, precision(\"grand_total\"));\n                }\n            }\n        \n            calculate_net_total() {\n                var me = this;\n                this.frm.doc.total_qty = this.frm.doc.total = this.frm.doc.base_total = this.frm.doc.net_total = this.frm.doc.base_net_total =\n                this.frm.doc[`${this.frm._custom_field}total_stnk`] = this.frm.doc[`${this.frm._custom_field}total_bpkb`] = this.frm.doc[`${this.frm._custom_field}total_bbn`] = 0.0;\n                \n                $.each(this.frm._items || [], function(i, item) {\n                    me.frm.doc[`${me.frm._custom_field}total_stnk`] += item[`${me.frm._custom_field}stnk_amount`];\n                    me.frm.doc[`${me.frm._custom_field}total_bpkb`] += item[`${me.frm._custom_field}bpkb_amount`]\n                    me.frm.doc[`${me.frm._custom_field}total_bbn`] += item[`${me.frm._custom_field}bbn_amount`]\n                    me.frm.doc.total += item.amount;\n                    me.frm.doc.total_qty += item.qty;\n                    me.frm.doc.base_total += item.base_amount;\n                    me.frm.doc.net_total += item.net_amount;\n                    me.frm.doc.base_net_total += item.base_net_amount;\n                });\n            }\n        \n            \n            calculate_totals() {\n                // Changing sequence can because of rounding adjustment issue and on-screen discrepancy\n                var me = this;\n                var tax_count = this.frm.doc[\"taxes\"] ? this.frm.doc[\"taxes\"].length : 0;\n                var stnk_bpkb = flt(me.frm.doc[`${this.frm._custom_field}total_stnk`]) + flt(me.frm.doc[`${this.frm._custom_field}total_bpkb`]) + flt(me.frm.doc[`${this.frm._custom_field}total_bbn`])\n                this.frm.doc.grand_total = flt(tax_count\n                    ? this.frm.doc[\"taxes\"][tax_count - 1].total + flt(this.frm.doc.rounding_adjustment)\n                    : this.frm.doc.net_total) + stnk_bpkb;\n                \n                if(in_list([\"Quotation\", \"Sales Order\", \"Delivery Note\", \"Sales Invoice\", \"Arrival Document\", \"POS Invoice\", \"SPK\", \"FPK\", \"Billing Document\"], this.frm.doc.doctype)) {\n                    this.frm.doc.base_grand_total = (this.frm.doc.total_taxes_and_charges) ?\n                        flt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : (this.frm.doc.base_net_total + stnk_bpkb);\n                } else {\n                    // other charges added/deducted\n                    this.frm.doc.taxes_and_charges_added = this.frm.doc.taxes_and_charges_deducted = 0.0;\n                    if(tax_count) {\n                        $.each(this.frm.doc[\"taxes\"] || [], function(i, tax) {\n                            if (in_list([\"Valuation and Total\", \"Total\"], tax.category)) {\n                                if(tax.add_deduct_tax == \"Add\") {\n                                    me.frm.doc.taxes_and_charges_added += flt(tax.tax_amount_after_discount_amount);\n                                } else {\n                                    me.frm.doc.taxes_and_charges_deducted += flt(tax.tax_amount_after_discount_amount);\n                                }\n                            }\n                        });\n\n                        frappe.model.round_floats_in(this.frm.doc,\n                            [\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n                    }\n\n                    this.frm.doc.base_grand_total = flt((this.frm.doc.taxes_and_charges_added || this.frm.doc.taxes_and_charges_deducted) ?\n                        flt(this.frm.doc.grand_total * this.frm.doc.conversion_rate) : this.frm.doc.base_net_total);\n\n                    this.set_in_company_currency(this.frm.doc,\n                        [\"taxes_and_charges_added\", \"taxes_and_charges_deducted\"]);\n                }\n\n                this.frm.doc.total_taxes_and_charges = flt(this.frm.doc.grand_total - this.frm.doc.net_total - stnk_bpkb\n                    - flt(this.frm.doc.rounding_adjustment), precision(\"total_taxes_and_charges\"));\n\n                this.set_in_company_currency(this.frm.doc, [\"total_taxes_and_charges\", \"rounding_adjustment\"]);\n\n                // Round grand total as per precision\n                frappe.model.round_floats_in(this.frm.doc, [\"grand_total\", \"base_grand_total\"]);\n\n                // rounded totals\n                this.set_rounded_total();\n            }\n        }\n    }\n}"],
  "mappings": "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",
  "names": ["extend_class", "frm", "has_margin_field", "ofr", "cdt", "cdn", "item", "doc", "me", "items", "i", "update_stock", "show_batch_dialog", "is_ard", "r", "d", "value", "k", "v", "key", "company_currency", "_a", "show", "item_grid", "fname", "children", "items_rule_dict", "child", "existing_pricing_rule", "effective_item_rate", "item_rate", "territory_field", "is_ignore_rule_bbn", "custom_term_portion", "rule", "is_quotation", "total_additional_items_fpk_spk", "qty", "tax", "tax_fields", "fieldname", "actual_tax_dict", "n", "item_tax_map", "current_tax_amount", "added_charge", "has_inclusive_tax", "row", "cumulated_tax_fraction", "total_inclusive_tax_amount_per_qty", "current_tax_fraction", "inclusive_tax_amount_per_qty", "amount", "distributed_amount", "total_for_discount_amount", "net_total", "discount_amount_loss", "total_actual_tax", "actual_taxes_dict", "tax_amount", "actual_tax_amount", "tax_count", "stnk_bpkb"]
}
